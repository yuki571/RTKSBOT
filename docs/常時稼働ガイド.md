# Discord Bot 常時稼働ガイド

## 🚀 常時稼働の方法

### 方法1: Windowsタスクスケジューラー（推奨）

1. **管理者権限でPowerShellを開く**
2. 以下のコマンドを実行:
   ```powershell
   Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
   .\setup_service.ps1
   ```
3. PC起動時に自動でボットが開始されます

### 方法2: バッチファイル

1. `start_bot.bat` をダブルクリック
2. ボットがクラッシュしても自動で再起動します
3. 手動で止めるまで実行し続けます

### 方法3: Pythonサービスラッパー

```bash
python service_wrapper.py
```

## 🛡️ 安定稼働のコツ

### 1. **Windows設定**
- **スリープ無効化**: 電源オプション → スリープ「なし」
- **自動更新延期**: Windows Update → アクティブ時間設定
- **ファイアウォール**: Python.exeを許可リストに追加

### 2. **ネットワーク設定**
- **安定したインターネット接続**
- **有線接続推奨**（Wi-Fiより安定）
- **DNS設定**: Google DNS (8.8.8.8, 8.8.4.4) 推奨

### 3. **PC環境**
- **十分な空き容量**: 最低1GB以上
- **メモリ**: 4GB以上推奨
- **温度管理**: PCの冷却確保

### 4. **ボット設定**
- **ログ監視**: `bot_log_YYYYMMDD.log` で状態確認
- **エラー制限**: 1時間10回以上エラーで一時停止
- **自動再接続**: Discord切断時に自動再接続

## 📊 監視とメンテナンス

### ログファイル
- `bot_log_YYYYMMDD.log`: 日別ログ
- エラー、警告、重要な動作が記録される

### 定期メンテナンス
- **週1回**: ログファイル確認
- **月1回**: PC再起動
- **四半期**: Pythonパッケージ更新

### トラブルシューティング

#### ボットが起動しない
1. `.env` ファイルのトークン確認
2. インターネット接続確認
3. Pythonバージョン確認 (`python --version`)

#### 頻繁にクラッシュする
1. ログファイル確認
2. メモリ使用量確認
3. Discord APIレート制限確認

#### 音楽機能が動かない
1. FFmpeg インストール確認 (`ffmpeg -version`)
2. ボイスチャンネル権限確認
3. YouTube-DLPアップデート

## 🔧 管理コマンド

### タスクスケジューラー
```powershell
# タスク開始
Start-ScheduledTask -TaskName "DiscordBot-AutoStart"

# タスク停止
Stop-ScheduledTask -TaskName "DiscordBot-AutoStart"

# タスク状態確認
Get-ScheduledTask -TaskName "DiscordBot-AutoStart"

# タスク削除
Unregister-ScheduledTask -TaskName "DiscordBot-AutoStart" -Confirm:$false
```

### サービス監視
```bash
# 直接実行
python bot.py

# サービスラッパー経由
python service_wrapper.py

# バッチファイル
start_bot.bat
```

## ⚠️ 注意事項

- **PC常時起動**: 電気代とハードウェア負荷に注意
- **セキュリティ**: 定期的なWindowsアップデート
- **バックアップ**: 設定ファイルの定期バックアップ
- **Discord利用規約**: 過度なAPI使用に注意

## 📞 トラブル時の対処

1. **即座の停止**: Ctrl+C または タスクマネージャー
2. **ログ確認**: 最新のログファイルをチェック
3. **PC再起動**: 解決しない場合の最終手段
4. **設定リセット**: 設定ファイルを初期化

---

**正常稼働時間の目安: 99%以上（月1回の再起動含む）**